// iComAPI.h: interface for the CiComAPI class.
//
//////////////////////////////////////////////////////////////////////

#if !defined(AFX_ICOMAPI_H__BAA63A3B_A495_4AEF_BE80_D9EE6DFC7545__INCLUDED_)
#define AFX_ICOMAPI_H__BAA63A3B_A495_4AEF_BE80_D9EE6DFC7545__INCLUDED_

#if _MSC_VER > 1000
#pragma once
#endif // _MSC_VER > 1000

#define _ICOM_EXPORT_
#include "iCom.h"
#include "ModBus.h"

#define WM_RX_TERMINAL			WM_USER + 102		// 自定义的更新终端数据消息

#define ICOMAPI_CLASSNAME	_T("MFCiComAPI")

class ICOM_API CiComAPI  : public CWnd
{
public:
	CiComAPI();
	CiComAPI(int iComPort, char cPrity, int iBaudrate, int iDataBits, int iStopBits, int iTimeout, int iScanTime,
		     int DevNum);
	virtual ~CiComAPI();

	BOOL RegisterWindowClass();
	BOOL ImportDevInfo(int TemIdx, BYTE TemId, BYTE TemCmd, BYTE TemChn, WORD TemAddr, BYTE TemTyp);
	BOOL Create(CWnd* parent, UINT nID, DWORD dwStyle = WS_CHILD);
	void SetWriteTerminalInfo(int iTemIdx, WORD iTemWriteAddr, WORD iTemWriteRegs, WORD *pTemRegBuff);
	void DestroyWindows();

public:
	CWnd    *m_pParentWnd;
	CModBus *m_pModBus;

	int      m_iComPort;
	int      m_iBaudrate;
	int      m_iDataBits;
	int      m_iStopBits;
	char     m_cPrity;
	int      m_iTimeout;
	int      m_iScanTime;

	BYTE		m_DevNum;
	LPTemObject m_pTemObjectBuff;

protected:
	//{{AFX_MSG(CModBus)
	// NOTE - the ClassWizard will add and remove member functions here.
	afx_msg LONG OnUpdateTerminal(WPARAM index, LPARAM len);
	//}}AFX_MSG
	DECLARE_MESSAGE_MAP()
};

#endif // !defined(AFX_ICOMAPI_H__BAA63A3B_A495_4AEF_BE80_D9EE6DFC7545__INCLUDED_)
